/* alv-ch-ng - 0.2.0 - 2015-01-13 - Copyright (c) 2015 Informatik der Arbeitslosenversicherung; */
!function(){"use strict";var a=angular.module("alv-ch-ng.ui-scroll",["alv-ch-ng.ui-core","alv-ch-ng.translate"]);a.service("ScrollService",["$window",function(a){var b=this;b.scrollY=function(){return a.scrollY?a.scrollY:a.pageYOffset?a.pageYOffset:a.document.documentElement&&document.documentElement.scrollTop?document.documentElement.scrollTop:a.document.body.scrollTop?document.body.scrollTop:0},b.positionTop=function(a){return a.offset()?a.offset().top:0}}]),a.factory("ScrollSpyService",function(){function a(a){d[a.id]=a}function b(){return d}function c(){d={}}var d={};return{addSpy:a,getSpies:b,clearSpies:c}}),a.controller("ScrollSpyCtrl",["$scope","ScrollService","ScrollSpyService",function(a,b,c){var d=this;d.checkSpy=function(d){var e,f,g;e=null,angular.forEach(c.getSpies(),function(a){a.out(),g=parseInt($("#"+a.id).css("margin-top"))+parseInt($("#"+a.id).css("padding-top")),f=b.positionTop($("#"+a.id))-d-g,f-b.scrollY()<=0&&(a.pos=f,null==e&&(e=a),e.pos<a.pos&&(e=a))}),null!==e&&(a.currentSpy=e.id,e["in"]())}}]),a.controller("ScrollFixCtrl",["$scope","$window","$document","ScrollService",function(a,b,c,d){var e=this,f=!0,g=!1,h=!1,i=!1,j={};e.parentSet=function(a,b,c){b===c&&e.doParentSet(a,c)},e.doParentSet=function(a,b){e.checkParent(b),j.overlayTop=e.overlayTop(b),e.checkElementTop(a),e.refreshDummyElement(a)},e.checkParent=function(a){i=!1,$("#"+a).hasClass("scroll-fixed")&&(i=!0)},e.getDummyElement=function(a){var b=angular.element('<div id="scroll-fix-'+j.elementId+'" style="height: '+a.outerHeight(!0)+'px;"></div>');return"100%"!==j.elementWidth&&b.css({width:j.elementWidth,"float":j.elementFloat}),b},e.refreshDummyElement=function(a){$("#scroll-fix-"+j.elementId).css("height",a.outerHeight(!0))},e.elementTop=function(a){return d.positionTop(a)-parseInt(a.css("margin-top"))-parseInt(a.css("padding-top"))},e.overlayTop=function(a){return a&&"undefined"!==$("#"+a).offset()?$("#"+a).outerHeight(!0)+d.positionTop($("#"+a))-d.scrollY():0},e.overlayBottom=function(a,b){return b?c.height()-$("#"+b).outerHeight(!0):0},e.elementTopPosition=function(a){return a?$("#"+a).outerHeight(!0):0},e.fixElement=function(b){b.addClass("scroll-fixed"),b.css("width",j.elementWidth),angular.isString(j.attrScrollFixBottom)&&!j.attrScrollFix?(b.css("bottom",0),b.before(e.getDummyElement(b))):(b.css("top",e.overlayTop(j.attrScrollFix)),b.after(e.getDummyElement(b))),g=!0,a.$broadcast("alv-ch-ng:dom-manipulate",{id:j.elementId,event:"scrollFix:fixed"})},e.releaseElement=function(b){b.removeClass("scroll-fixed"),$("#scroll-fix-"+j.elementId).remove(),angular.isString(j.attrScrollFixBottom)&&!j.attrScrollFix?b.css("bottom","auto"):b.css("top","auto"),g=!1,a.$broadcast("alv-ch-ng:dom-manipulate",{id:j.elementId,event:"scrollFix:release"})},e.fixTopBottomElement=function(b){b.removeAttr("style"),b.removeClass("scroll-fixed"),b.addClass("scroll-fixed-bottom"),b.css("bottom",parseInt(b.css("margin-bottom"))+parseInt(b.css("padding-bottom"))),h=!0,a.$broadcast("alv-ch-ng:dom-manipulate",{id:j.elementId,event:"scrollFix:topBottom:fixed"})},e.releaseTopBottomElement=function(b){b.removeAttr("style"),b.removeClass("scroll-fixed-bottom"),b.addClass("scroll-fixed"),b.css("top",e.overlayTop(j.attrScrollFix)),h=!1,a.$broadcast("alv-ch-ng:dom-manipulate",{id:j.elementId,event:"scrollFix:topBottom:released"})},e.resizeElement=function(b,c){j.elementWidth=c,b.css("width",c),a.$broadcast("alv-ch-ng:dom-manipulate",{id:j.elementId,event:"scrollFix:resize"})},e.checkElement=function(a){e.checkElementTop(a),e.checkFix(a)&&e.fixElement(a),e.checkRelease(a)&&e.releaseElement(a),e.checkTopBottom(a)},e.checkElementTop=function(a){j.elementTop===e.elementTop(a)||g||(j.elementTop=e.elementTop(a))},e.checkElementWidth=function(a){var b=$("#scroll-fix-"+j.elementId).outerWidth(!0)||"100%";"100%"!==j.elementWidth&&b!==j.elementWidth&&e.resizeElement(a,b),e.doParentSet(a,j.attrScrollFix)},e.checkFix=function(a){if(!g){if(d.scrollY()+e.overlayTop(j.attrScrollFix)>e.elementTop(a)&&(e.checkParent(j.attrScrollFix),angular.isString(j.attrScrollFix)&&i||!j.attrScrollFix))return!0;if(angular.isString(j.attrScrollFixBottom)&&!j.attrScrollFix&&d.scrollY()+$(window).height()<=e.overlayBottom(a,j.attrScrollFixBottom))return!0}return!1},e.checkRelease=function(a){if(g){if(angular.isString(j.attrScrollFix)&&j.elementTop>d.scrollY()+j.overlayTop)return!0;if(angular.isString(j.attrScrollFixBottom)&&!j.attrScrollFix&&d.scrollY()+$(window).height()>e.overlayBottom(a,j.attrScrollFixBottom))return!0}return!1},e.checkTopBottom=function(a){if(angular.isString(j.attrScrollFix)&&angular.isString(j.attrScrollFixBottom)){var b=c.height()-($("#"+j.attrScrollFixBottom).outerHeight(!0)+a.outerHeight(!0)+parseInt(a.css("margin-bottom"))+parseInt(a.css("padding-bottom"))),f=c.height()-($("#"+j.attrScrollFixBottom).outerHeight(!0)+a.outerHeight(!0)+parseInt(a.css("margin-bottom"))+parseInt(a.css("padding-bottom"))+e.overlayTop(j.attrScrollFix));f<=d.scrollY()&&!h&&e.fixTopBottomElement(a),b>d.scrollY()+e.overlayTop(j.attrScrollFix)&&h&&e.releaseTopBottomElement(a)}},e.init=function(a,b){j=b,j.overlayTop=e.overlayTop(j.attrScrollFix),j.attrScrollFixBottom||e.fixElement(a),e.checkElement(a),f=!1}}]),a.directive("scrollFix",["$window","$document",function(a,b){return{priority:10,restrict:"A",controller:"ScrollFixCtrl",link:function(c,d,e,f){var g=e.scrollFix||!1,h=e.scrollFixBottom||!1,i=e.id||"random_"+Math.floor(6*Math.random()+1);void 0===e.id&&d.attr("id",i);var j=f.elementTop(d),k=d.outerHeight(!0),l="100%";d.outerWidth(!0)<b.width()&&(l=d.outerWidth(!0));var m=d.css("float"),n={attrScrollFix:g,attrScrollFixBottom:h,elementId:i,elementTop:j,elementHeight:k,elementWidth:l,elementFloat:m,overlayTop:"auto"};$(a).scroll(function(){f.checkElement(d)}),$(a).resize(function(){f.checkElementWidth(d)}),b.ready(function(){f.init(d,n)}),c.$on("$viewContentLoaded",function(){f.checkElement(d)}),c.$on("alv-ch-ng:dom-manipulate",function(a,b){f.parentSet(d,b.id,e.scrollFix)})}}}]),a.directive("scrollSpy",["$rootScope","$window","ScrollSpyService",function(a,b,c){return{restrict:"A",priority:20,controller:"ScrollSpyCtrl",link:function(d,e,f,g){var h=0;angular.forEach($("body").find("*[scroll-fix]"),function(a){var b=angular.element(a);void 0===b.attr("scroll-fix-bottom")&&(h+=b.outerHeight(!0))}),$(b).scroll(function(){g.checkSpy(h)}),a.$on("$translateChangeSuccess",function(){}),d.$on("$routeChangeSuccess",function(){c.clearSpies()})}}}]),a.directive("spy",["ScrollSpyService",function(a){return{restrict:"A",priority:30,link:function(b,c,d){a.addSpy({id:d.spy,"in":function(){c.addClass("active")},out:function(){c.removeClass("active")}})}}}]),a.directive("scrollUp",["$compile","$window","$document","$location","$anchorScroll","ScrollService","UiRenderService",function(a,b,c,d,e,f,g){return{restrict:"A",priority:10,link:function(h,i,j){var k=i;"BODY"!==i.prop("tagName")&&(k=$("body"));var l=i.attr("id")||"document-top";void 0===k.attr("id")&&k.attr("id",l);var m=!1,n=j.scrollUp||!1,o=$("*[scroll-fix-bottom]").attr("id")||!1,p=angular.element('<a id="scroll-up" ng-click="scrollTop()" translate="'+g.getScrollUpI18n()+'" style="display: none; bottom: '+g.getScrollUpBottom()+'px;"></a>');a(p)(h),k.append(p);var q=$("#"+n).outerHeight(!0)+$("#scroll-up").outerHeight(!0)+g.getScrollUpBottom();angular.isString(o)&&(q-=$("#"+o).outerHeight(!0)),$(b).scroll(function(){var a=c.height()-$("#"+n).outerHeight(!0);angular.isString(o)&&(a+=$("#"+o).outerHeight(!0)),f.scrollY()>g.getScrollUp()&&!m?($("#scroll-up").css("display","block"),m=!0):f.scrollY()<g.getScrollUp()&&m&&($("#scroll-up").css("display","none"),m=!1),f.scrollY()+$(window).height()>a?($("#scroll-up").css("bottom",q),$("#scroll-up").css("position","relative")):($("#scroll-up").css("bottom",g.getScrollUpBottom()),$("#scroll-up").css("position","fixed"))}),h.scrollTop=function(){e(),d.hash(l),h.$broadcast("alv-ch-ng:dom-manipulate",{id:l,event:"scrollUp:scrollTop"})}}}}])}();